/*!
 __                                            __    
/\ \                      __                  /\ \__
\ \ \        ___     ___ /\_\    ___      __  \ \ ,_\   ___   _ __
 \ \ \  __  / __`\  /'___\/\ \ /' _ `\  /'__`\ \ \ \/  / __`\/\`'__\
  \ \ \_\ \/\ \_\ \/\ \__/\ \ \/\ \/\ \/\ \_\.\_\ \ \_/\ \_\ \ \ \/ 
   \ \____/\ \____/\ \____\\ \_\ \_\ \_\ \__/.\_\\ \__\ \____/\ \_\ 
    \/___/  \/___/  \/____/ \/_/\/_/\/_/\/__/\/_/ \/__/\/___/  \/_/ 
*/
function httpInterceptor(a){"use strict";var b,c=["$q","$injector","$location",function(a,c,d){function e(a){return b=b||c.get("$http"),b.pendingRequests.length<1&&(g=g||c.get("requestNotificationChannel"),g.requestEnded()),a}function f(e){var f=e.status;return b=b||c.get("$http"),b.pendingRequests.length<1&&(g=g||c.get("requestNotificationChannel"),g.requestEnded()),404===f?(d.path("/404"),a.reject(e)):a.reject(e)}var g;return function(a){return g=g||c.get("requestNotificationChannel"),g.requestStarted(),a.then(e,f)}}];a.responseInterceptors.push(c)}httpInterceptor.$inject=["$httpProvider"],angular.module("nypl_research_collections",["ngSanitize","ui.router","ngAnimate","locationService","coordinateService","angulartics","angulartics.google.analytics","nyplNavigation","nyplSSO","nyplBreadcrumbs","nyplSearch"]).config(["$analyticsProvider","$locationProvider","$stateProvider","$urlRouterProvider","$crumbProvider",function(a,b,c,d,e){"use strict";function f(a,b){return b.allDivisions().then(function(a){return a.divisions})["catch"](function(a){throw a})}function g(a){return a.getConfig()}a.virtualPageviews(!1),f.$inject=["config","nyplLocationsService"],g.$inject=["nyplLocationsService"],b.html5Mode(!0),d.rule(function(a,b){var c=b.url();return"/"===c[c.length-1]?c.slice(0,-1):void 0}),e.setOptions({primaryState:{name:"Home",customUrl:"http://nypl.org"}}),d.otherwise("/"),c.state("division",{url:"/",templateUrl:"views/research-collections.html",controller:"CollectionsCtrl",label:"Research Collections",resolve:{config:g,divisions:f},data:{crumbName:"Research Collections"}})}]).config(httpInterceptor).run(["$analytics","$rootScope",function(a,b){b.$on("$viewContentLoaded",function(){a.pageTrack("/research-collections")})}]),function(a,b,c){"use strict";function d(){var a={primaryState:{name:null,customUrl:null},secondaryState:{name:null,customUrl:null}};this.setOptions=function(c){b.extend(a,c)},this.$get=["$state","$stateParams",function(b,c){var d=function(a,d){var e,f;for(e=0,f=a.length;f>e;e+=1)if(a[e].name===d.name)return;d["abstract"]||d.customUrl&&(d.url=b.href(d.name,c||{}),a.unshift(d))};return{getConfigChain:function(){var b=[];return a.secondaryState&&d(b,a.secondaryState),a.primaryState&&d(b,a.primaryState),b}}}]}function e(a,d,e){return{restrict:"E",templateUrl:"scripts/components/nypl_breadcrumbs/nypl_breadcrumbs.html",scope:{crumbName:"@"},link:function(f){function g(a,c){var d,e=a.split("."),f=c;for(d=0;d<e.length;d+=1)b.isDefined(f[e[d]])&&(f=f[e[d]]);return f}function h(a){var b,c=a;return a["abstract"]===!0&&("undefined"!=typeof f.abstractProxyProperty?(b=g(f.abstractProxyProperty,a),c=b?d.get(b):!1):c=!1),c}function i(b){var c,d,e;return f.crumbName?(d=g(f.crumbName,b),c="undefined"!=typeof b.locals?b.locals.globals:b,d===!1?!1:"undefined"==typeof d?b.name:c?e=a(d)(c):void 0):b.name}function j(a){var b,d,e,f,g=a,h=g.data.parentState,i={},j="undefined"!=typeof a.locals?a.locals.globals:a;return"object"==typeof j&&h&&j.$stateParams?(d=n(a),b=m(j,h),e=l(j),f=k(j),d&&b&&(i={displayName:d,route:b}),e&&f&&(i.division={name:e,route:f}),i?i:c):c}function k(a){var b,d,e=a,f="division";return"object"==typeof e?(Object.keys(e).forEach(function(a){"$stateParams"!==a&&(d=e[a])}),d._embedded!==c&&d._embedded.parent&&d._embedded.parent.slug?(b=d._embedded.parent.slug,f+'({ "'+f+'":"'+b+'"})'):c):c}function l(a){var b,d,e=a;return"object"==typeof e?(Object.keys(e).forEach(function(a){"$stateParams"!==a&&(d=e[a])}),d._embedded!==c&&d._embedded.parent&&d._embedded.parent.name?b=d._embedded.parent.name:c):c}function m(a,b){var d,e,f=a,g=b;return"object"==typeof f&&g?(Object.keys(f).forEach(function(a){"$stateParams"!==a&&(e=f[a])}),e.amenity?e.amenity.id&&(d=e.amenity.id):e._embedded&&e._embedded.location&&e._embedded.location.slug&&(d=e._embedded.location.slug),d?g+'({ "'+g+'":"'+d+'"})':g):c}function n(b){var e,f,g=b.data.parentState,h=d.get(g),i="undefined"!=typeof b.locals?b.locals.globals:b;if(h){if(e=a(h.data.crumbName)(i))return e;if("object"==typeof i)return Object.keys(i).forEach(function(a){"$stateParams"!==a&&(f=i[a])}),f.amenity?f.amenity.name&&(e=f.amenity.name):f._embedded&&f._embedded.location&&f._embedded.location.name&&(e=f._embedded.location.name),e?e:g}return c}function o(a,b){var c,d=!1;for(c=0;c<b.length;c++)b[c].route===a.name&&(d=!0);return d}function p(){var a,b,c,g,k=[],l=d.$current,m=e.getConfigChain();if(m)for(a=0;a<m.length;a+=1)k.push({displayName:m[a].name,route:m[a].customUrl});for(g=j(l),g&&(g.displayName&&g.route&&k.push({displayName:g.displayName,route:g.route}),g.division&&k.push({displayName:g.division.name,route:g.division.route}));l&&""!==l.name;)b=h(l),b&&(c=i(b),c===!1||o(b,k)||k.push({displayName:c,route:b.name})),l.parent&&(l=l.parent);f.breadcrumbs=k}f.breadcrumbs=[],""!==d.$current.name&&p(),f.$on("$stateChangeSuccess",function(){p()})}}}e.$inject=["$interpolate","$state","$crumb"],b.module("nyplBreadcrumbs",[]).provider("$crumb",d).directive("nyplBreadcrumbs",e)}(window,window.angular),function(){"use strict";function a(a,b){var c=null,d={};return d.geolocationAvailable=function(){return b.navigator||b.navigator.geolocation?!0:!1},d.getBrowserCoordinates=function(){var d=a.defer();return this.geolocationAvailable()?b.navigator.geolocation.getCurrentPosition(function(a){c=a.coords,d.resolve(c)},function(a){switch(a.code){case a.PERMISSION_DENIED:d.reject(new Error("Permission denied."));break;case a.POSITION_UNAVAILABLE:d.reject(new Error("The position is currently unavailable."));break;case a.TIMEOUT:d.reject(new Error("The request timed out."));break;default:d.reject(new Error("Unknown error."))}},{enableHighAccuracy:!0,timeout:5e3,maximumAge:6e5}):d.reject(new Error("Your browser does not support Geolocation.")),d.promise},d.getDistance=function(a,b,c,d){if(!(a&&d&&c&&d))return void 0;var e,f=Math.PI*a/180,g=Math.PI*c/180,h=b-d,i=Math.PI*h/180;return e=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos(i),e=Math.acos(e),e=180*e/Math.PI,e=60*e*1.1515,Math.ceil(100*e)/100},d}a.$inject=["$q","$window"],angular.module("coordinateService",[]).factory("nyplCoordinatesService",a)}(),function(){"use strict";function a(a,b){return{restrict:"E",templateUrl:"scripts/components/nypl_feedback/nypl_feedback.html",replace:!0,scope:{height:"@",width:"@",url:"@",side:"@"},link:function(c,d){var e="right";c.trusted_url=a.trustAsResourceUrl(c.url),c.feedback="Feedback","left"===c.side?(d.addClass("left"),e="left"):d.addClass("right"),b.$watch("close_feedback",function(a){a&&(b.close_feedback=!1,d.removeClass("open"),c.feedback="Feedback")}),d.find("a").click(function(){d.toggleClass("open"),c.feedback=d.hasClass("open")?"Close":"Feedback",c.$apply()})}}}a.$inject=["$sce","$rootScope"],angular.module("nyplFeedback",[]).directive("nyplFeedback",a)}(),function(){"use strict";function a(a,b){var c,d,e="?callback=JSON_CALLBACK",f="Could not reach API",g={};return g.getConfig=function(){var a=b.defer();return d?a.resolve(d):(d=window.locations_cfg.config,d?(c=d.api_root+"/"+d.api_version,a.resolve(d)):a.reject(f+": config")),a.promise},g.allLocations=function(){var d=b.defer();return a.jsonp(c+"/locations"+e,{cache:!0}).success(function(a){d.resolve(a)}).error(function(){d.reject(f+": locations")}),d.promise},g.singleLocation=function(d){var g=b.defer();return a.jsonp(c+"/locations/"+d+e,{cache:!0}).success(function(a){g.resolve(a)}).error(function(){g.reject(f+": location")}),g.promise},g.allDivisions=function(){var d=b.defer();return a.jsonp(c+"/divisions/?callback=JSON_CALLBACK",{cache:!0}).success(function(a){d.resolve(a)}).error(function(){d.reject(f+": division")}),d.promise},g.singleDivision=function(d){var g=b.defer();return a.jsonp(c+"/divisions/"+d+e,{cache:!0}).success(function(a){g.resolve(a)}).error(function(){g.reject(f+": division")}),g.promise},g.amenities=function(d){var g=b.defer(),h=d?"/amenities/"+d:"/amenities";return a.jsonp(c+h+e,{cache:!0}).success(function(a){g.resolve(a)}).error(function(){g.reject(f+": amenities")}),g.promise},g.amenitiesAtLibrary=function(d){var g=b.defer();return a.jsonp(c+"/locations/"+d+"/amenities"+e,{cache:!0}).success(function(a){g.resolve(a)}).error(function(){g.reject(f+": library-amenity")}),g.promise},g.alerts=function(){var d=b.defer();return a.jsonp(c+"/alerts"+e,{cache:!0}).success(function(a){d.resolve(a)}).error(function(){d.reject(f+": site-wide alerts")}),d.promise},g.terms=function(){var d=b.defer();return a.jsonp(c+"/terms?callback=JSON_CALLBACK",{cache:!0}).success(function(a){d.resolve(a)}).error(function(){d.reject(f+": terms")}),d.promise},g}a.$inject=["$http","$q"],angular.module("locationService",[]).factory("nyplLocationsService",a)}(),function(){"use strict";function a(a,b,c){return{restrict:"E",scope:{activenav:"@"},replace:!0,templateUrl:"scripts/components/nypl_navigation/nypl_navigation.html",link:function(d){$(".dropDown").hover(function(){$(this).addClass("openDropDown")},function(){$(this).removeClass("openDropDown")}),c.$watch("current_url",function(){d.logout_url="https://nypl.bibliocommons.com/user/logout?destination="+c.current_url}),$(".mobile-login").click(function(c){c.preventDefault(),a.logged_in()?b.location.href=d.logout_url:$(".sso-login").toggleClass("visible")}),d.menuLabel="Log In",a.logged_in()&&(d.menuLabel="Log Out")}}}function b(){return{restrict:"E",scope:{},replace:!0,templateUrl:"scripts/components/nypl_navigation/nypl_collapsed_buttons.html",link:function(a,b){var c=b.find(".nav-open-button"),d=b.find(".search-open-button");c.click(function(){return $(this).toggleClass("open"),d.removeClass("open"),$("#search-block-form-input").removeClass("open-search"),$(".search-options-resp").removeClass("open"),$("#search-top").removeClass("open"),$("#main-nav").toggleClass("open-navigation"),$(".sso-login").removeClass("visible"),!1}),d.click(function(){return $(this).toggleClass("open"),c.removeClass("open"),$("#search-block-form-input").toggleClass("open-search"),$("#search-top").toggleClass("open"),$("#main-nav").removeClass("open-navigation"),$(".sso-login").removeClass("visible"),!1})}}}a.$inject=["ssoStatus","$window","$rootScope"],angular.module("nyplNavigation",[]).directive("nyplNavigation",a).directive("nyplCollapsedButtons",b)}(),function(){"use strict";function a(a){return{restrict:"E",scope:{},replace:!0,templateUrl:"scripts/components/nypl_search/nypl_search.html",link:function(b,c){function d(a){var b=a.closest("li");return b.hasClass("search-the-catalog")?l.term.attr("placeholder",l.prompt.catalog):b.hasClass("search-the-website")?l.term.attr("placeholder",l.prompt.site):l.term.attr("placeholder",l.prompt.default_val)}function e(){return $.trim(l.term.val())}function f(a){return void 0===a&&(a="Please enter a search term"),l.term.addClass("error").attr("placeholder",a)}function g(){return l.term.removeClass("error").attr("placeholder","")}function h(){return!l.mobile_flag.is(":visible")}function i(a){return void 0===a&&(a=l.choices.find("input[type=radio]:checked").parent()),$.trim(a.text()).toLowerCase()}function j(b){var c,d=e();return void 0===b&&(b=i()),0===d.length?(f(),a.eventTrack("Empty Search",{category:"Header Search",label:""}),!1):("nypl.org"===b?(c=window.location.protocol+"//nypl.org/search/apachesolr_search/"+d,a.eventTrack("Submit Search",{category:"Header Search",label:d})):(c="http://nypl.bibliocommons.com/search?t=smart&q="+d+"&commit=Search&searchOpt=catalogue",a.eventTrack("Submit Catalog Search",{category:"Header Search",label:d})),window.location=c,!1)}function k(){angular.element("html").click(function(){c.find(".pseudo-select").removeClass("open"),c.find(".error").removeClass("error")});var b=c;l.term=b.find("#search-block-form-input"),l.search_button=b.find(".search_button"),l.choices=b.find(".pseudo-select"),l.mobile_flag=b.find(".search-button"),l.prompt={default_val:l.term.attr("placeholder"),catalog:"Search the catalog",site:"Search NYPL.org"},b.click(function(a){a.stopPropagation()}),b.find("#search-block-form").submit(function(){return l.search_button.click(),!1}),l.term.focus(function(){l.choices.addClass("open"),a.eventTrack("Focused",{category:"Header Search",label:"Search Box"})}),l.term.focus(function(){g()}),b.find(".search-button").click(function(){return j()}),l.choices.find("li input").click(function(){d(angular.element(this)),a.eventTrack("Select",{category:"Header Search",label:i()})}),l.choices.find("li").click(function(){h()&&(0===e().length?f():j(i(angular.element(this))))})}var l={};k()}}}a.$inject=["$analytics"],angular.module("nyplSearch",["angulartics","angulartics.google.analytics"]).directive("nyplSearch",a)}(),function(){"use strict";function a(a,b,c){return{restrict:"E",scope:{},replace:!0,templateUrl:"scripts/components/nypl_sso/nypl_sso.html",link:function(d){function e(d,e,f,g){var h="";a.remembered()&&(d.val(a.remember()),f.attr("checked",!0)),f.click(function(){$(this).is(":checked")||a.forget()}),c.$watch("current_url",function(){h=c.current_url}),g.click(function(c){var g="https://nypl.bibliocommons.com/user/login?destination=";c.preventDefault(),f.is(":checked")&&a.remember(d.val()),g+=h.replace("#","%23")+"&",g+="name="+d.val(),g+="&user_pin="+e.val(),b.location.href=g})}function f(b){var c={username:"#username",pin:"#pin",remember_checkbox:"#remember_me",login_button:"#login-form-submit"},d=$.extend({},c,b);a.logged_in()&&h.addClass("logged-in"),e($(d.username),$(d.pin),$(d.remember_checkbox),$(d.login_button))}function g(){c.$watch("current_url",function(){d.logout_url="https://nypl.bibliocommons.com/user/logout?destination="+c.current_url}),d.header_button_label="LOG IN",a.logged_in()&&(d.header_button_label=a.login(),i.addClass("logged-in")),i.click(function(){h.toggleClass("visible")})}{var h=$(".sso-login"),i=$(".login-button"),j=$("#header-news_signup input[type=email]"),k=$("#header-news_signup input[type=submit]");$(".header-newsletter-signup")}j.focus(function(){$(".newsletter_policy").slideDown()}),j.blur(function(){$(".newsletter_policy").slideUp()}),k.click(function(){return""===j.val()?(j.focus(),!1):void 0}),f(),g()}}}function b(){var a={};return a.login=function(){return $.cookie("bc_username")},a.logged_in=function(){return!(!this.login()||null===this.login())},a.remember=function(a){return a?$.cookie("remember_me",a,{path:"/"}):$.cookie("remember_me")},a.remembered=function(){var a=this.remember();return!(!a||null===a)},a.forget=function(){return $.removeCookie("remember_me",{path:"/"})},a}a.$inject=["ssoStatus","$window","$rootScope"],angular.module("nyplSSO",[]).service("ssoStatus",b).directive("nyplSso",a)}(),function(){function a(a,b,c,d,e,f,g,h){function i(){return a.filter_results[0].active?a.filter_results[0].subterms?a.filter_results[0].subterms:[{id:a.filter_results[0].id}]:!1}function j(){return _.chain(a.filter_results).filter(function(a){return a.active&&"Subjects"!==a.label}).map(function(a){return a.id}).value()}function k(b){return _.chain(a.divisions).filter(function(a){var c=!1;return _.each(b,function(b){_.each(a.terms,function(a){c||(c=_.find(a.terms,function(a){return a.id===b.id}))})}),!!c}).sortBy(function(a){return a.name}).flatten().value()}function l(a,b){return _.chain(b).filter(function(b){var c=[];return _.each(a,function(a){var d=!1;_.each(b.terms,function(b){d||(d=_.find(b.terms,function(b){return b.id===a}),d&&c.push(!0))}),d||b._embedded.location.id===a&&c.push(!0)}),c.length===a.length}).sortBy(function(a){return a.name}).flatten().value()}function m(){var b=j(),c=[],d=i();a.showActiveFilters=b.length||d.length?!0:!1,c=d.length?k(d):a.divisions,a.filteredDivisions=0===b.length?c:l(b,c)}function n(b,c){var d,e="";return"Subjects"===b?(_.each(a.terms[0].terms,function(a){_.findWhere(a.terms,{name:c.name})&&(e=a.name+" - ")}),d=e+c.name):d="Locations"===b?c.short_name:c.name,d}function o(b){var c=a.activeCategory,d=n(c,b),e=_.findWhere(a.filter_results,{label:c,name:d});return e?(a["selected"+c+"Subterm"]=void 0,void _.each(a.filter_results,function(a){a.label===c&&(a.name="",a.active=!1,a.id=void 0,"Subjects"===a.label&&(a.subterms=void 0))})):void _.each(a.filter_results,function(a){a.label===c&&(a.name=d,a.active=!0,a.id=b.id,"Subjects"===a.label&&(a.name=d,a.subterms=b.terms))})}function p(b){a["selected"+a.activeCategory+"Subterm"]=b}var q,r=h.getResearchValues(),s=d.research_order||["SASB","LPA","SC","SIBL"],t=function(a){_.each(a,function(a){a.hours&&(a.hoursToday=g.hoursToday(a.hours))})},u=function(){return f.terms().then(function(b){var c=[];_.each(b.terms,function(a){var b=a.terms,d="Subjects"===a.name?0:1;c[d]={id:a.id,name:a.name,terms:b}}),c.push({name:"Locations",locations:a.divisionLocations}),a.terms=c})},v=function(){return f.singleLocation("sibl").then(function(b){t([b.location]),q=b.location,q._embedded.location={id:"SIBL"},a.filteredDivisions.push(q),a.divisions.push(q),a.divisionLocations.push(q),_.each(a.divisionLocations,function(a){a.short_name=d.research_shortnames[a.id]})})};b.title="Research Collections",a.filter_results=[{label:"Subjects",name:"",id:void 0,active:!1,subterms:void 0},{label:"Media",name:"",id:void 0,active:!1},{label:"Locations",name:"",id:void 0,active:!1}],t(e),_.each(e,function(a){var b=a._embedded.location;b.short_name=d.research_shortnames[b.id]}),a.divisions=e,a.terms=[],a.filteredDivisions=r.filteredDivisions||_.chain(e).sortBy(function(a){return a.name}).flatten().value(),a.divisionLocations=_.chain(e).pluck("_embedded").flatten().pluck("location").indexBy("id").sortBy(function(a){return g.researchLibraryOrder(s,a.id)}).flatten().value(),v(),u(),a.selectCategory=function(b,c){return a.categorySelected===b?(a.categorySelected=void 0,void(a.activeCategory=void 0)):(a.activeCategory=c.name,void(a.categorySelected=b))},a.filterDivisionsBy=function(b,d){return p(b),o(d),g.isMobile().any()&&c(function(){a.categorySelected=void 0,a.activeCategory=void 0},700),m()},a.removeFilter=function(b){a["selected"+b.label+"Subterm"]=void 0,b.active=!1,b.name="",b.id=void 0,m()}}a.$inject=["$scope","$rootScope","$timeout","config","divisions","nyplLocationsService","nyplUtility","researchCollectionService"],angular.module("nypl_research_collections").controller("CollectionsCtrl",a)}(),function(){"use strict";function a(a){return{restrict:"A",link:function(b,c){var d=function(){c.addClass("show")},e=function(){c.removeClass("show")};c.hasClass("show")&&c.removeClass("show"),a.onRequestStarted(b,d),a.onRequestEnded(b,e)}}}function b(){function a(a,b,c){var d=c.collapse,e=c.className||"open",f=c.duration||"fast";a.$eval(d)||b.hide(),a.$watch(d,function(a,c){a!==c&&(a?b.stop(!0,!0).slideDown(f).addClass(e):b.stop(!0,!0).slideUp(f).removeClass(e))})}return{link:a,restrict:"A"}}function c(a){return{restrict:"E",templateUrl:"scripts/directives/templates/footer.html",replace:!0,scope:{},link:function(b,c){var d,e=c.find(".footerlinks a");e.click(function(){d=angular.element(this).attr("href"),a.eventTrack("Click",{category:"footer",label:d})})}}}function d(){return{restrict:"AE",templateUrl:"scripts/directives/templates/collapsible-filters.html",replace:!1,scope:{items:"=data",filterItem:"&",filteredResults:"="},link:function(a,b){var c=b.find(".collapsible-control"),d=b.find(".collapsible-filters");a.toggleFilters=function(){c.hasClass("open")?(c.removeClass("open"),d.removeClass("open")):($(".collapsible-control").removeClass("open"),$(".collapsible-filters").removeClass("open"),c.addClass("open"),d.addClass("open"))},a.checkActiveFilter=function(b,c){return a.activeFilter=_.findWhere(b,{id:c})}}}}a.$inject=["requestNotificationChannel"],c.$inject=["$analytics"],angular.module("nypl_research_collections").directive("collapse",b).directive("collapsibleFilters",d).directive("nyplFooter",c).directive("loadingWidget",a)}(),function(){"use strict";function a(){function a(a){var b=a.split(":"),c=(parseInt(b[0],10)+11)%12+1,d=b[1],e=b[0]>=12?"pm":"am";return c+":"+d+e}return function(b){var c=void 0!==b&&void 0!==b.today?b.today:b;return c?null===c.open?"Closed":a(c.open)+" - "+a(c.close):(console.log("timeFormat() filter function error: Argument is not defined or empty, verify API response for time"),"")}}function b(){return function(a){return new Date(a).toISOString()}}function c(){return function(a){return"string"==typeof a?a.replace(/(^|\s)([a-z])/g,function(a){return a.toUpperCase()}):a}}function d(){function a(a){return a=a.split(":"),_.object(["hours","mins","meridian","military"],[(parseInt(a[0],10)+11)%12+1,a[1],a[0]>=12?"pm":"am",parseInt(a[0],10)])}return function(b){var c,d,e,f,g,h,i=new Date,j=i.getHours();return b?(e=b.today,f=b.tomorrow,e.open&&e.close?(e.open&&(c=a(e.open)),e.close&&(d=a(e.close)),null!==f.open&&(g=a(f.open)),null!==f.close&&(h=a(f.close)),j>=d.military?g&&h?"Open tomorrow "+g.hours+(0!==parseInt(g.mins,10)?":"+g.mins:"")+g.meridian+"-"+h.hours+(0!==parseInt(h.mins,10)?":"+h.mins:"")+h.meridian:"Closed today":j<c.military?"Open today "+c.hours+(0!==parseInt(c.mins,10)?":"+c.mins:"")+c.meridian+"-"+d.hours+(0!==parseInt(d.mins,10)?":"+d.mins:"")+d.meridian:"Open today until "+d.hours+(0!==parseInt(d.mins,10)?":"+d.mins:"")+d.meridian):(console.log("Obj is undefined for open/close properties"),"Closed today")):"Not available"}}function e(){return function(a){return a.replace(/\s+/g,"-").toLowerCase()}}angular.module("nypl_research_collections").filter("timeFormat",a).filter("dateToISO",b).filter("capitalize",c).filter("hoursTodayFormat",d).filter("slugify",e)}(),function(){"use strict"}(),function(){"use strict";function a(){var a={},b={};return a.setResearchValue=function(a,c){return b[a]=c,this},a.getResearchValues=function(){return b},a.resetResearchValues=function(){return b={},this},a}a.$inject=["$filter"],angular.module("nypl_research_collections").factory("researchCollectionService",a)}(),function(){"use strict";function a(a){var b="_START_REQUEST_",c="_END_REQUEST_",d={};return d.requestStarted=function(){a.$broadcast(b)},d.requestEnded=function(){a.$broadcast(c)},d.onRequestStarted=function(a,c){a.$on(b,function(a){c(a)})},d.onRequestEnded=function(a,b){a.$on(c,function(a){b(a)})},d}function b(a,b,c){var d={};return d.hoursToday=function(a){var b,c=new Date,d=c.getDay(),e=d+1;return a&&(b={today:{day:a.regular[d].day,open:a.regular[d].open,close:a.regular[d].close},tomorrow:{day:a.regular[e%7].day,open:a.regular[e%7].open,close:a.regular[e%7].close}}),b},d.formatDate=function(a,b){var c,d=["January","February","March","April","May","June","July","August","September","October","November","December"];if(this.numDaysFromToday=function(a,b){return Math.round((a.valueOf()-b.valueOf())/1e3/86400-.5)},a&&b){var e=new Date(a),f=new Date(b),g=new Date,h=this.numDaysFromToday(f,g);if(!h)return;c=365>=h?e.getTime()<=g.getTime()&&f.getTime()>=g.getTime()?"Now through "+d[f.getUTCMonth()]+" "+f.getUTCDate()+", "+f.getUTCFullYear():e.getTime()>g.getTime()&&f.getTime()>=g.getTime()?"Opening "+d[e.getUTCMonth()]+" "+e.getUTCDate()+", "+e.getUTCFullYear():d[e.getUTCMonth()]+" "+e.getUTCDate()+", "+e.getUTCFullYear()+" through "+d[f.getUTCMonth()]+" "+f.getUTCDate()+", "+f.getUTCFullYear():"Ongoing"}return c},d.branchException=function(a){var b={};if(a){if(!a.exceptions)return null;if(""!==a.exceptions.description.trim())return b.desc=a.exceptions.description,a.exceptions.start&&(b.start=a.exceptions.start),a.exceptions.end&&(b.end=a.exceptions.end),b}return null},d.getAddressString=function(a,b){if(!a)return"";var c=" ",d=a.name;return b&&(c="<br />",d="<a href='/locations/"+a.slug+"'>"+a.name+"</a>"),d+c+a.street_address+c+a.locality+", "+a.region+", "+a.postal_code},d.socialMediaColor=function(a){return _.each(a,function(a){switch(a.classes="icon-",a.site){case"facebook":a.classes+=a.site+" blueDarkerText";break;case"foursquare":a.classes+=a.site+" blueText";break;case"instagram":a.classes+=a.site+" blackText";break;case"twitter":a.classes+=a.site+"2 blueText";break;case"tumblr":a.classes+=a.site+"2 indigoText";break;case"youtube":case"pinterest":a.classes+=a.site+" redText";break;default:a.classes+=a.site}}),a},d.alerts=function(a){var b,c,d=new Date,e=[];return a&&Array.isArray(a)&&a.length>0&&(_.each(a,function(a){b=new Date(a.start),c=new Date(a.end),d>=b&&c>=d&&e.push(a.body)}),!angular.isUndefined(e))?_.uniq(e):null},d.holidayClosings=function(a){function b(a,b){return a.getFullYear()===b.getFullYear()&&a.getDate()===b.getDate()&&a.getMonth()===b.getMonth()}var c,d=a||new Date,e=[{day:new Date(2015,0,26),title:"Closing at 5 pm due to severe weather"},{day:new Date(2015,0,27),title:"Closed due to severe weather"},{day:new Date(2015,1,16),title:"Closed for Presidents' Day"},{day:new Date(2015,3,5),title:"Closed for Easter"},{day:new Date(2015,4,23),title:"Closed for Memorial Day weekend"},{day:new Date(2015,4,24),title:"Closed for Memorial Day weekend"},{day:new Date(2015,4,25),title:"Closed for Memorial Day weekend"},{day:new Date(2015,6,4),title:"Closed for Independence Day"}];return c=_.filter(e,function(a){return b(a.day,d)?a:void 0}),c.length>0?{day:c[0].day,title:c[0].title}:void 0},d.popupWindow=function(a,c,d,e){var f,g,h,i,j;a&&(f=void 0===d?"300":"string"==typeof d||d instanceof String?d:d.toString(),g=void 0===e?"500":"string"==typeof d||d instanceof String?e:e.toString(),a&&c?h=b.open(a,c,"menubar=1,resizable=1,width="+f+",height="+g):a&&(h=b.open(a,"","menubar=1,resizable=1,width="+f+",height="+g)),h&&(j=parseInt(f,10),i=parseInt(g,10),h.moveTo(screen.width/2-j/2,screen.height/2-i/2)))},d.calendarLink=function(a,b,c){if(!a||!b||!c)return"";var d=b.title,e=b.start.replace(/[\-:]/g,""),f=b.end.replace(/[\-:]/g,""),g=b.body,h=b._links.self.href,i=c.name+" - "+c.street_address+" "+c.locality+", "+c.region+" "+c.postal_code,j="";switch(a){case"google":j="https://www.google.com/calendar/render?action=template&text="+d+"&dates="+e+"/"+f+"&details="+g+"&location="+i+"&pli=1&uid=&sf=true&output=xml";break;case"yahoo":j="https://calendar.yahoo.com/?v=60&TITLE="+d+"&ST="+e+"&in_loc="+i+"&in_st="+i+"&DESC="+g+"&URL="+h}return j},d.icalLink=function(a,c){if(!a||!c)return"";var d=(new Date).toJSON().toString().replace(/[\-.:]/g,""),e="http://nypl.org/"+a._links.self.href,f="BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//NYPL//NONSGML v1.0//EN\nMETHOD:PUBLISH\nBEGIN:VEVENT\nUID:"+(new Date).getTime()+"\nDTSTAMP:"+d+"\nATTENDEE;CN=My Self ;\nORGANIZER;CN=NYPL:\nDTSTART:"+a.start.replace(/[\-:]/g,"")+"\nDTEND:"+a.end.replace(/[\-:]/g,"")+"\nLOCATION:"+c+"\nDESCRIPTION:"+a.body+"\nURL;VALUE=URI:"+e+"\nSUMMARY:"+a.title+"\nEND:VEVENT\nEND:VCALENDAR",g="data:text/calendar;chartset=utf-8,"+encodeURI(f);return b.open(g),g},d.isMobile=function(){var a={android:function(){return navigator.userAgent.match(/(android|bb\d+|meego).+mobile/i)},blackberry:function(){return navigator.userAgent.match(/BlackBerry/i)},ios:function(){return navigator.userAgent.match(/iPhone|iPod/i)},opera:function(){return navigator.userAgent.match(/Opera Mini/i)},windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return this.android()||this.blackberry()||this.ios()||this.opera()||this.windows()}};return a},d.calcDistance=function(a,b){if(!a)return[];var d={latitude:b.latitude||b.lat,longitude:b.longitude||b["long"]};return _.each(a,function(a){var b,e,f=[];a.geolocation&&a.geolocation.coordinates&&(f=a.geolocation.coordinates),b=a.lat||f[1],e=a["long"]||f[0],a.distance=c.getDistance(d.latitude,d.longitude,b,e)}),a},d.checkDistance=function(a){var b=_.pluck(a,"distance");return _.min(b)>25?!0:!1},d.returnHTML=function(b){return a.trustAsHtml(b)},d.divisionHasAppointment=function(a,b){return _.contains(a,b)},d.researchLibraryOrder=function(a,b){return _.indexOf(a,b)},d}a.$inject=["$rootScope"],b.$inject=["$sce","$window","nyplCoordinatesService"],angular.module("nypl_research_collections").factory("nyplUtility",b).factory("requestNotificationChannel",a)}();