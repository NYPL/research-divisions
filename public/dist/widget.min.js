/*!
  ____                               _     _             _
 |  _ \ ___  ___  ___  __ _ _ __ ___| |__ (_)_ __   __ _| |_ ___  _ __
 | |_) / _ \/ __|/ _ \/ _` | '__/ __| '_ \| | '_ \ / _` | __/ _ \| '__|
 |  _ <  __/\__ \  __/ (_| | | | (__| | | | | | | | (_| | || (_) | |
 |_| \_\___||___/\___|\__,_|_|  \___|_| |_|_|_| |_|\__,_|\__\___/|_|
*/
function httpInterceptor(a){"use strict";var b,c=["$q","$injector","$location",function(a,c,d){function e(a){return b=b||c.get("$http"),b.pendingRequests.length<1&&(g=g||c.get("requestNotificationChannel"),g.requestEnded()),a}function f(e){var f=e.status;return b=b||c.get("$http"),b.pendingRequests.length<1&&(g=g||c.get("requestNotificationChannel"),g.requestEnded()),404===f?(d.path("/404"),a.reject(e)):a.reject(e)}var g;return function(a){return g=g||c.get("requestNotificationChannel"),g.requestStarted(),a.then(e,f)}}];a.responseInterceptors.push(c)}!function(){"use strict";function a(a,b){var c=null,d={};return d.geolocationAvailable=function(){return b.navigator||b.navigator.geolocation?!0:!1},d.getBrowserCoordinates=function(){var d=a.defer();return this.geolocationAvailable()?b.navigator.geolocation.getCurrentPosition(function(a){c=a.coords,d.resolve(c)},function(a){switch(a.code){case a.PERMISSION_DENIED:d.reject(new Error("Permission denied."));break;case a.POSITION_UNAVAILABLE:d.reject(new Error("The position is currently unavailable."));break;case a.TIMEOUT:d.reject(new Error("The request timed out."));break;default:d.reject(new Error("Unknown error."))}},{enableHighAccuracy:!0,timeout:5e3,maximumAge:6e5}):d.reject(new Error("Your browser does not support Geolocation.")),d.promise},d.getDistance=function(a,b,c,d){if(!(a&&d&&c&&d))return void 0;var e,f=Math.PI*a/180,g=Math.PI*c/180,h=b-d,i=Math.PI*h/180;return e=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos(i),e=Math.acos(e),e=180*e/Math.PI,e=60*e*1.1515,Math.ceil(100*e)/100},d}a.$inject=["$q","$window"],angular.module("coordinateService",[]).factory("nyplCoordinatesService",a)}(),function(){"use strict";function a(a,b){var c,d,e="?callback=JSON_CALLBACK",f="Could not reach API",g={};return g.getConfig=function(){var a=b.defer();return d?a.resolve(d):(d=window.locations_cfg.config,d?(c=d.api_root+"/"+d.api_version,a.resolve(d)):a.reject(f+": config")),a.promise},g.allLocations=function(){var d=b.defer();return a.jsonp(c+"/locations"+e,{cache:!0}).success(function(a){d.resolve(a)}).error(function(){d.reject(f+": locations")}),d.promise},g.singleLocation=function(d){var g=b.defer();return a.jsonp(c+"/locations/"+d+e,{cache:!0}).success(function(a){g.resolve(a)}).error(function(){g.reject(f+": location")}),g.promise},g.allDivisions=function(){var d=b.defer();return a.jsonp(c+"/divisions/?callback=JSON_CALLBACK",{cache:!0}).success(function(a){d.resolve(a)}).error(function(){d.reject(f+": division")}),d.promise},g.singleDivision=function(d){var g=b.defer();return a.jsonp(c+"/divisions/"+d+e,{cache:!0}).success(function(a){g.resolve(a)}).error(function(){g.reject(f+": division")}),g.promise},g.amenities=function(d){var g=b.defer(),h=d?"/amenities/"+d:"/amenities";return a.jsonp(c+h+e,{cache:!0}).success(function(a){g.resolve(a)}).error(function(){g.reject(f+": amenities")}),g.promise},g.amenitiesAtLibrary=function(d){var g=b.defer();return a.jsonp(c+"/locations/"+d+"/amenities"+e,{cache:!0}).success(function(a){g.resolve(a)}).error(function(){g.reject(f+": library-amenity")}),g.promise},g.alerts=function(){var d=b.defer();return a.jsonp(c+"/alerts"+e,{cache:!0}).success(function(a){d.resolve(a)}).error(function(){d.reject(f+": site-wide alerts")}),d.promise},g.terms=function(){var d=b.defer();return a.jsonp(c+"/terms?callback=JSON_CALLBACK",{cache:!0}).success(function(a){d.resolve(a)}).error(function(){d.reject(f+": terms")}),d.promise},g}a.$inject=["$http","$q"],angular.module("locationService",[]).factory("nyplLocationsService",a)}(),httpInterceptor.$inject=["$httpProvider"],angular.module("nypl_research_collections",["ngSanitize","ui.router","ngAnimate","locationService","coordinateService","angulartics","angulartics.google.analytics","nyplNavigation","nyplSSO","nyplBreadcrumbs","nyplSearch"]).config(["$analyticsProvider","$locationProvider","$stateProvider","$urlRouterProvider","$crumbProvider",function(a,b,c,d,e){"use strict";function f(a,b){return b.allDivisions().then(function(a){return a.divisions})["catch"](function(a){throw a})}function g(a){return a.getConfig()}a.virtualPageviews(!1),f.$inject=["config","nyplLocationsService"],g.$inject=["nyplLocationsService"],b.html5Mode(!0),d.rule(function(a,b){var c=b.url();return"/"===c[c.length-1]?c.slice(0,-1):void 0}),e.setOptions({primaryState:{name:"Home",customUrl:"http://nypl.org"}}),d.otherwise("/"),c.state("division",{url:"/",templateUrl:"views/research-collections.html",controller:"CollectionsCtrl",label:"Research Collections",resolve:{config:g,divisions:f},data:{crumbName:"Research Collections"}})}]).config(httpInterceptor).run(["$analytics","$rootScope",function(a,b){b.$on("$viewContentLoaded",function(){a.pageTrack("/research-collections")})}]),function(){"use strict";function a(){function a(a){var b=a.split(":"),c=(parseInt(b[0],10)+11)%12+1,d=b[1],e=b[0]>=12?"pm":"am";return c+":"+d+e}return function(b){var c=void 0!==b&&void 0!==b.today?b.today:b;return c?null===c.open?"Closed":a(c.open)+" - "+a(c.close):(console.log("timeFormat() filter function error: Argument is not defined or empty, verify API response for time"),"")}}function b(){return function(a){return new Date(a).toISOString()}}function c(){return function(a){return"string"==typeof a?a.replace(/(^|\s)([a-z])/g,function(a){return a.toUpperCase()}):a}}function d(){function a(a){return a=a.split(":"),_.object(["hours","mins","meridian","military"],[(parseInt(a[0],10)+11)%12+1,a[1],a[0]>=12?"pm":"am",parseInt(a[0],10)])}return function(b){var c,d,e,f,g,h,i=new Date,j=i.getHours();return b?(e=b.today,f=b.tomorrow,e.open&&e.close?(e.open&&(c=a(e.open)),e.close&&(d=a(e.close)),null!==f.open&&(g=a(f.open)),null!==f.close&&(h=a(f.close)),j>=d.military?g&&h?"Open tomorrow "+g.hours+(0!==parseInt(g.mins,10)?":"+g.mins:"")+g.meridian+"-"+h.hours+(0!==parseInt(h.mins,10)?":"+h.mins:"")+h.meridian:"Closed today":j<c.military?"Open today "+c.hours+(0!==parseInt(c.mins,10)?":"+c.mins:"")+c.meridian+"-"+d.hours+(0!==parseInt(d.mins,10)?":"+d.mins:"")+d.meridian:"Open today until "+d.hours+(0!==parseInt(d.mins,10)?":"+d.mins:"")+d.meridian):(console.log("Obj is undefined for open/close properties"),"Closed today")):"Not available"}}function e(){return function(a){return a.replace(/\s+/g,"-").toLowerCase()}}angular.module("nypl_research_collections").filter("timeFormat",a).filter("dateToISO",b).filter("capitalize",c).filter("hoursTodayFormat",d).filter("slugify",e)}(),function(){"use strict";function a(a){return{restrict:"A",link:function(b,c){var d=function(){c.addClass("show")},e=function(){c.removeClass("show")};c.hasClass("show")&&c.removeClass("show"),a.onRequestStarted(b,d),a.onRequestEnded(b,e)}}}function b(){function a(a,b,c){var d=c.collapse,e=c.className||"open",f=c.duration||"fast";a.$eval(d)||b.hide(),a.$watch(d,function(a,c){a!==c&&(a?b.stop(!0,!0).slideDown(f).addClass(e):b.stop(!0,!0).slideUp(f).removeClass(e))})}return{link:a,restrict:"A"}}function c(a){return{restrict:"E",templateUrl:"scripts/directives/templates/footer.html",replace:!0,scope:{},link:function(b,c){var d,e=c.find(".footerlinks a");e.click(function(){d=angular.element(this).attr("href"),a.eventTrack("Click",{category:"footer",label:d})})}}}function d(){return{restrict:"AE",templateUrl:"scripts/directives/templates/collapsible-filters.html",replace:!1,scope:{items:"=data",parentTermName:"=",filterItem:"&",filteredResults:"="},link:function(a,b){var c=b.find(".collapsible-control"),d=b.find(".collapsible-filters");a.toggleFilters=function(){c.hasClass("open")?(c.removeClass("open"),d.removeClass("open")):($(".collapsible-control").removeClass("open"),$(".collapsible-filters").removeClass("open"),c.addClass("open"),d.addClass("open"))},a.checkActiveFilter=function(b,c){return a.activeFilter=_.findWhere(b,{id:c})}}}}a.$inject=["requestNotificationChannel"],c.$inject=["$analytics"],angular.module("nypl_research_collections").directive("collapse",b).directive("collapsibleFilters",d).directive("nyplFooter",c).directive("loadingWidget",a)}(),function(){"use strict";function a(a){var b="_START_REQUEST_",c="_END_REQUEST_",d={};return d.requestStarted=function(){a.$broadcast(b)},d.requestEnded=function(){a.$broadcast(c)},d.onRequestStarted=function(a,c){a.$on(b,function(a){c(a)})},d.onRequestEnded=function(a,b){a.$on(c,function(a){b(a)})},d}function b(a,b,c){var d={};return d.hoursToday=function(a){var b,c=new Date,d=c.getDay(),e=d+1;return a&&(b={today:{day:a.regular[d].day,open:a.regular[d].open,close:a.regular[d].close},tomorrow:{day:a.regular[e%7].day,open:a.regular[e%7].open,close:a.regular[e%7].close}}),b},d.formatDate=function(a,b){var c,d=["January","February","March","April","May","June","July","August","September","October","November","December"];if(this.numDaysFromToday=function(a,b){return Math.round((a.valueOf()-b.valueOf())/1e3/86400-.5)},a&&b){var e=new Date(a),f=new Date(b),g=new Date,h=this.numDaysFromToday(f,g);if(!h)return;c=365>=h?e.getTime()<=g.getTime()&&f.getTime()>=g.getTime()?"Now through "+d[f.getUTCMonth()]+" "+f.getUTCDate()+", "+f.getUTCFullYear():e.getTime()>g.getTime()&&f.getTime()>=g.getTime()?"Opening "+d[e.getUTCMonth()]+" "+e.getUTCDate()+", "+e.getUTCFullYear():d[e.getUTCMonth()]+" "+e.getUTCDate()+", "+e.getUTCFullYear()+" through "+d[f.getUTCMonth()]+" "+f.getUTCDate()+", "+f.getUTCFullYear():"Ongoing"}return c},d.branchException=function(a){var b={};if(a){if(!a.exceptions)return null;if(""!==a.exceptions.description.trim())return b.desc=a.exceptions.description,a.exceptions.start&&(b.start=a.exceptions.start),a.exceptions.end&&(b.end=a.exceptions.end),b}return null},d.getAddressString=function(a,b){if(!a)return"";var c=" ",d=a.name;return b&&(c="<br />",d="<a href='/locations/"+a.slug+"'>"+a.name+"</a>"),d+c+a.street_address+c+a.locality+", "+a.region+", "+a.postal_code},d.socialMediaColor=function(a){return _.each(a,function(a){switch(a.classes="icon-",a.site){case"facebook":a.classes+=a.site+" blueDarkerText";break;case"foursquare":a.classes+=a.site+" blueText";break;case"instagram":a.classes+=a.site+" blackText";break;case"twitter":a.classes+=a.site+"2 blueText";break;case"tumblr":a.classes+=a.site+"2 indigoText";break;case"youtube":case"pinterest":a.classes+=a.site+" redText";break;default:a.classes+=a.site}}),a},d.alerts=function(a){var b,c,d=new Date,e=[];return a&&Array.isArray(a)&&a.length>0&&(_.each(a,function(a){b=new Date(a.start),c=new Date(a.end),d>=b&&c>=d&&e.push(a.body)}),!angular.isUndefined(e))?_.uniq(e):null},d.holidayClosings=function(a){function b(a,b){return a.getFullYear()===b.getFullYear()&&a.getDate()===b.getDate()&&a.getMonth()===b.getMonth()}var c,d=a||new Date,e=[{day:new Date(2015,0,26),title:"Closing at 5 pm due to severe weather"},{day:new Date(2015,0,27),title:"Closed due to severe weather"},{day:new Date(2015,1,16),title:"Closed for Presidents' Day"},{day:new Date(2015,3,5),title:"Closed for Easter"},{day:new Date(2015,4,23),title:"Closed for Memorial Day weekend"},{day:new Date(2015,4,24),title:"Closed for Memorial Day weekend"},{day:new Date(2015,4,25),title:"Closed for Memorial Day weekend"},{day:new Date(2015,6,4),title:"Closed for Independence Day"}];return c=_.filter(e,function(a){return b(a.day,d)?a:void 0}),c.length>0?{day:c[0].day,title:c[0].title}:void 0},d.popupWindow=function(a,c,d,e){var f,g,h,i,j;a&&(f=void 0===d?"300":"string"==typeof d||d instanceof String?d:d.toString(),g=void 0===e?"500":"string"==typeof d||d instanceof String?e:e.toString(),a&&c?h=b.open(a,c,"menubar=1,resizable=1,width="+f+",height="+g):a&&(h=b.open(a,"","menubar=1,resizable=1,width="+f+",height="+g)),h&&(j=parseInt(f,10),i=parseInt(g,10),h.moveTo(screen.width/2-j/2,screen.height/2-i/2)))},d.calendarLink=function(a,b,c){if(!a||!b||!c)return"";var d=b.title,e=b.start.replace(/[\-:]/g,""),f=b.end.replace(/[\-:]/g,""),g=b.body,h=b._links.self.href,i=c.name+" - "+c.street_address+" "+c.locality+", "+c.region+" "+c.postal_code,j="";switch(a){case"google":j="https://www.google.com/calendar/render?action=template&text="+d+"&dates="+e+"/"+f+"&details="+g+"&location="+i+"&pli=1&uid=&sf=true&output=xml";break;case"yahoo":j="https://calendar.yahoo.com/?v=60&TITLE="+d+"&ST="+e+"&in_loc="+i+"&in_st="+i+"&DESC="+g+"&URL="+h}return j},d.icalLink=function(a,c){if(!a||!c)return"";var d=(new Date).toJSON().toString().replace(/[\-.:]/g,""),e="http://nypl.org/"+a._links.self.href,f="BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//NYPL//NONSGML v1.0//EN\nMETHOD:PUBLISH\nBEGIN:VEVENT\nUID:"+(new Date).getTime()+"\nDTSTAMP:"+d+"\nATTENDEE;CN=My Self ;\nORGANIZER;CN=NYPL:\nDTSTART:"+a.start.replace(/[\-:]/g,"")+"\nDTEND:"+a.end.replace(/[\-:]/g,"")+"\nLOCATION:"+c+"\nDESCRIPTION:"+a.body+"\nURL;VALUE=URI:"+e+"\nSUMMARY:"+a.title+"\nEND:VEVENT\nEND:VCALENDAR",g="data:text/calendar;chartset=utf-8,"+encodeURI(f);return b.open(g),g},d.isMobile=function(){var a=b.matchMedia("(min-width: 480px)");return a.matches?!1:!0},d.calcDistance=function(a,b){if(!a)return[];var d={latitude:b.latitude||b.lat,longitude:b.longitude||b["long"]};return _.each(a,function(a){var b,e,f=[];a.geolocation&&a.geolocation.coordinates&&(f=a.geolocation.coordinates),b=a.lat||f[1],e=a["long"]||f[0],a.distance=c.getDistance(d.latitude,d.longitude,b,e)}),a},d.checkDistance=function(a){var b=_.pluck(a,"distance");return _.min(b)>25?!0:!1},d.returnHTML=function(b){return a.trustAsHtml(b)},d.divisionHasAppointment=function(a,b){return _.contains(a,b)},d.researchLibraryOrder=function(a,b){return _.indexOf(a,b)},d}a.$inject=["$rootScope"],b.$inject=["$sce","$window","nyplCoordinatesService"],angular.module("nypl_research_collections").factory("nyplUtility",b).factory("requestNotificationChannel",a)}();